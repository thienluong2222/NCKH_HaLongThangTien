<!-- Loading State -->
@if (festivalService.isLoading()) {
  <div class="results-container heritage-card loading-state fade-in-up">
    <div class="loading-content">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-icon">üîç</div>
      </div>
      <h3>ƒêang ph√¢n t√≠ch...</h3>
      <p>AI ƒëang nh·∫≠n d·∫°ng c√°c y·∫øu t·ªë l·ªÖ h·ªôi trong ph∆∞∆°ng ti·ªán c·ªßa b·∫°n</p>
      <div class="loading-progress">
        <div class="progress-bar"></div>
      </div>
    </div>
  </div>
}

<!-- Results State -->
@if (festivalService.hasResults() && !festivalService.isLoading()) {
  <div class="results-container winner-state" [@cardState]="'visible'">
    <!-- Decorative Elements -->
    <div class="winner-decoration">
      <div class="lantern lantern-1">üèÆ</div>
      <div class="lantern lantern-2">üèÆ</div>
      <div class="sparkle sparkle-1">‚ú®</div>
      <div class="sparkle sparkle-2">‚ú®</div>
      <div class="sparkle sparkle-3">‚ú®</div>
    </div>
    
    <div class="winner-content">
      <!-- Trophy Badge -->
      <div class="trophy-badge">
        <span class="trophy-icon">üèÜ</span>
        <span class="trophy-label">Top 3 k·∫øt qu·∫£ ph√¢n t√≠ch</span>
      </div>
      
      <!-- Top 3 Results -->
      <div class="top-three-results">
        @for (result of festivalService.topThree(); track result.name; let i = $index) {
          <div class="result-item" [class.winner]="i === 0" [class.second]="i === 1" [class.third]="i === 2">
            <div class="rank-badge">
              @if (i === 0) {
                <span class="rank-icon">ü•á</span>
              } @else if (i === 1) {
                <span class="rank-icon">ü•à</span>
              } @else {
                <span class="rank-icon">ü•â</span>
              }
            </div>
            
            <div class="result-info">
              <h3 class="result-name">{{ result.name }}</h3>
              <p class="result-description">{{ result.description }}</p>
            </div>
            
            <div class="result-confidence">
              <span class="confidence-value" [style.color]="result.color || 'var(--heritage-gold)'">
                {{ result.confidence }}%
              </span>
              <div class="confidence-bar-container">
                <div 
                  class="confidence-bar" 
                  [style.width.%]="result.confidence"
                  [style.background]="result.color || 'var(--heritage-gold)'">
                </div>
              </div>
            </div>
          </div>
        }
      </div>
      
      <!-- Winner Highlight -->
      @if (festivalService.winner(); as winner) {
        <div class="winner-highlight">
          <div class="highlight-header">
            <mat-icon>emoji_events</mat-icon>
            <span>K·∫øt qu·∫£ ch√≠nh x√°c nh·∫•t</span>
          </div>
          
          <div class="highlight-content">
            <div class="highlight-ring">
              <svg viewBox="0 0 100 100">
                <defs>
                  <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#D4A853"/>
                    <stop offset="50%" stop-color="#CD7F32"/>
                    <stop offset="100%" stop-color="#8B2323"/>
                  </linearGradient>
                </defs>
                <circle 
                  class="ring-bg" 
                  cx="50" cy="50" r="42" 
                  fill="none" 
                  stroke="rgba(212, 168, 83, 0.15)" 
                  stroke-width="8"/>
                <circle 
                  class="ring-progress" 
                  cx="50" cy="50" r="42" 
                  fill="none" 
                  stroke="url(#ringGradient)" 
                  stroke-width="8"
                  stroke-linecap="round"
                  [style.stroke-dasharray]="getCircumference(42)"
                  [style.stroke-dashoffset]="getOffset(42)"
                  transform="rotate(-90 50 50)"/>
              </svg>
              <div class="ring-value">
                <span class="value">{{ winner.confidence }}</span>
                <span class="percent">%</span>
              </div>
            </div>
            
            <div class="highlight-info">
              <h2>{{ winner.name }}</h2>
              <p>{{ winner.description }}</p>
              <div class="cultural-badge">
                <mat-icon>verified</mat-icon>
                <span>Di s·∫£n VƒÉn h√≥a Phi v·∫≠t th·ªÉ</span>
              </div>
            </div>
          </div>
        </div>
      }
      
      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="btn-heritage primary">
          <mat-icon>share</mat-icon>
          <span>Chia s·∫ª k·∫øt qu·∫£</span>
        </button>
        <button class="btn-heritage secondary" (click)="festivalService.reset()">
          <mat-icon>refresh</mat-icon>
          <span>Ph√¢n t√≠ch m·ªõi</span>
        </button>
      </div>
    </div>
  </div>
}

<!-- Empty State -->
@if (!festivalService.hasResults() && !festivalService.isLoading()) {
  <div class="results-container heritage-card empty-state fade-in-up">
    <div class="empty-content">
      <div class="empty-illustration">
        <div class="illustration-bg"></div>
        <span class="illustration-icon">üé≠</span>
        <div class="illustration-ring"></div>
      </div>
      <h3>S·∫µn s√†ng kh√°m ph√°</h3>
      <p>T·∫£i l√™n h√¨nh ·∫£nh ho·∫∑c video ƒë·ªÉ nh·∫≠n d·∫°ng l·ªÖ h·ªôi vƒÉn h√≥a Vi·ªát Nam</p>
      <div class="empty-features">
        <div class="feature">
          <mat-icon>photo_camera</mat-icon>
          <span>H√¨nh ·∫£nh</span>
        </div>
        <div class="feature">
          <mat-icon>videocam</mat-icon>
          <span>Video</span>
        </div>
        <div class="feature">
          <mat-icon>auto_awesome</mat-icon>
          <span>AI Analysis</span>
        </div>
      </div>
    </div>
  </div>
}
